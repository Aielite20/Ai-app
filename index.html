<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Elites - Fixed with Real AI Integration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-btn {
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        .title {
            font-size: 18px;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .share-btn, .menu-btn {
            font-size: 20px;
            cursor: pointer;
            color: white;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .top-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hamburger {
            display: flex;
            flex-direction: column;
            gap: 4px;
            cursor: pointer;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 2px;
        }

        .brand {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .chat-container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            position: relative;
        }

        .welcome-section {
            text-align: center;
            margin-top: 50px;
            opacity: 0.7;
        }

        .welcome-text {
            font-size: 28px;
            font-weight: 300;
            margin-bottom: 30px;
            color: rgba(255, 255, 255, 0.8);
        }

        .quick-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }

        .message.user {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            align-self: flex-end;
            margin-left: auto;
        }

        .message.ai {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            align-self: flex-start;
            backdrop-filter: blur(10px);
        }

        .input-container {
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 12px 20px;
            gap: 15px;
        }

        .attach-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        .message-input {
            flex: 1;
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
        }

        .message-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .send-btn {
            background: white;
            border: none;
            color: #667eea;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: scale(1.05);
        }

        .console-section {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #00ff00;
        }

        .console-title {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            color: white;
        }

        .version-info {
            text-align: center;
            padding: 10px;
            color: rgba(255, 255, 255, 0.5);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .error-message {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <span class="close-btn">Ã—</span>
            <span class="title">AI Elites - Fixed with Real AI Integration</span>
        </div>
        <div class="header-right">
            <span class="share-btn">ðŸ“¤</span>
            <span class="menu-btn">â‹®</span>
        </div>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="brand">AI ELITES</div>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="welcome-section" id="welcomeSection">
                <div class="welcome-text">Welcome to AI Elites</div>
                <div class="quick-actions">
                    <button class="action-btn" onclick="startImageGeneration()">ðŸŽ¨ Image Generation</button>
                    <button class="action-btn" onclick="askLifeTips()">ðŸ’¡ Life Tips</button>
                </div>
            </div>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <button class="attach-btn" onclick="attachFile()">+</button>
                <input type="text" class="message-input" id="messageInput" placeholder="Type your message..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <div class="console-section">
        <div class="console-title">ðŸ“‹ Console Messages</div>
        <div id="consoleOutput">AI Elites Chat Interface Loaded Successfully</div>
        <div class="version-info">Version 2 of 2</div>
    </div>

    <script>
        // Chat state management
        let chatHistory = [];
        let isProcessing = false;

        // DOM elements
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const welcomeSection = document.getElementById('welcomeSection');
        const consoleOutput = document.getElementById('consoleOutput');

        // Initialize chat
        function initializeChat() {
            addConsoleMessage("Initializing AI Elites Chat System...");
            addConsoleMessage("Chat interface ready for user interaction");
        }

        // Add message to chat
        function addMessage(content, isUser = false) {
            // Hide welcome section once chat starts
            if (welcomeSection.style.display !== 'none') {
                welcomeSection.style.display = 'none';
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            messageDiv.textContent = content;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Store in history
            chatHistory.push({
                content: content,
                isUser: isUser,
                timestamp: new Date()
            });
        }

        // Add console message
        function addConsoleMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `<br>[${timestamp}] ${message}`;
        }

        // Send message function with enhanced error handling
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isProcessing) return;

            // Validate message length
            if (message.length > 1000) {
                showError('Message is too long. Please keep it under 1000 characters.');
                return;
            }

            // Check if API key is configured
            if (AI_CONFIG.apiKey === 'YOUR_API_KEY_HERE') {
                showError('API key not configured. Please add your API key to the AI_CONFIG section.');
                addConsoleMessage('ERROR: API key not configured in AI_CONFIG');
                return;
            }

            // Add user message
            addMessage(message, true);
            messageInput.value = '';
            isProcessing = true;

            // Show loading with timeout
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.textContent = 'AI is thinking...';
            loadingDiv.style.display = 'block';
            chatContainer.appendChild(loadingDiv);

            // Set timeout for API response
            const timeoutId = setTimeout(() => {
                if (loadingDiv.parentNode) {
                    chatContainer.removeChild(loadingDiv);
                    showError('Request timed out. Please try again.');
                    isProcessing = false;
                }
            }, 30000); // 30 second timeout

            try {
                addConsoleMessage(`Sending request: "${message.substring(0, 50)}..."`);
                
                const response = await generateAIResponse(message);
                
                clearTimeout(timeoutId);
                
                // Remove loading
                if (loadingDiv.parentNode) {
                    chatContainer.removeChild(loadingDiv);
                }
                
                // Validate response
                if (!response || response.length < 2) {
                    throw new Error('Invalid response received');
                }
                
                // Add AI response
                addMessage(response, false);
                addConsoleMessage(`âœ“ AI response generated successfully`);
                
            } catch (error) {
                clearTimeout(timeoutId);
                
                // Remove loading
                if (loadingDiv.parentNode) {
                    chatContainer.removeChild(loadingDiv);
                }
                
                showError(`AI Error: ${error.message}`);
                addConsoleMessage(`âœ— Error: ${error.message}`);
            }

            isProcessing = false;
        }

        // Show error function
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            chatContainer.appendChild(errorDiv);
            
            // Auto-remove error after 5 seconds
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    chatContainer.removeChild(errorDiv);
                }
            }, 5000);
        }

        // AI Configuration - ADD YOUR API KEY HERE
        const AI_CONFIG = {
            apiKey: 'AIzaSyBIFd815--pDu-ChkJhwXY4WYa3nrYOFE8', // Replace with: AIzaSyBIFd815--pDu-ChkJhwXY4WYa3nrYOFE8
            apiUrl: 'https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent',
            model: 'gemini-pro'
        };

        // Generate AI response with proper API integration
        async function generateAIResponse(userMessage) {
            try {
                // Prevent empty or repetitive messages
                if (!userMessage || userMessage.length < 2) {
                    return "I need a bit more information to help you properly. Could you please elaborate?";
                }

                // Check for recent duplicate messages
                const recentMessages = chatHistory.slice(-3);
                const isDuplicate = recentMessages.some(msg => 
                    msg.isUser && msg.content.toLowerCase() === userMessage.toLowerCase()
                );
                
                if (isDuplicate) {
                    return "I notice you've asked this recently. Is there something specific about my previous response you'd like me to clarify or expand on?";
                }

                // Build conversation context
                const conversationContext = chatHistory.slice(-6).map(msg => ({
                    role: msg.isUser ? 'user' : 'model',
                    parts: [{ text: msg.content }]
                }));

                // Add current message
                conversationContext.push({
                    role: 'user',
                    parts: [{ text: userMessage }]
                });

                // Prepare API request
                const requestBody = {
                    contents: conversationContext,
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 1000,
                        topP: 0.8,
                        topK: 40
                    },
                    safetySettings: [
                        {
                            category: "HARM_CATEGORY_HARASSMENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_HATE_SPEECH", 
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        }
                    ]
                };

                // Make API call
                const response = await fetch(`${AI_CONFIG.apiUrl}?key=${AI_CONFIG.apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                
                // Extract response text
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    
                    // Validate response to prevent loops
                    if (aiResponse && aiResponse.length > 10 && !aiResponse.includes('I understand your question about')) {
                        return aiResponse;
                    } else {
                        return "I'm having trouble generating a proper response. Could you rephrase your question?";
                    }
                } else {
                    throw new Error('Invalid response format from API');
                }

            } catch (error) {
                addConsoleMessage(`API Error: ${error.message}`);
                
                // Fallback responses to prevent complete failure
                const fallbackResponses = {
                    'hello': "Hello! I'm AI Elites. How can I assist you today?",
                    'biology': "Yes, I can help with biology questions! What specific topic interests you?",
                    'help': "I'm here to help! What would you like to know about?",
                    'default': "I apologize, but I'm experiencing some technical difficulties. Please try rephrasing your question."
                };

                const lowerMessage = userMessage.toLowerCase();
                
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                    return fallbackResponses.hello;
                } else if (lowerMessage.includes('biology')) {
                    return fallbackResponses.biology;
                } else if (lowerMessage.includes('help')) {
                    return fallbackResponses.help;
                } else {
                    return fallbackResponses.default;
                }
            }
        }

        // Handle Enter key press
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Quick action functions
        function startImageGeneration() {
            addMessage("I'd like to generate an image", true);
            setTimeout(() => {
                addMessage("I can help you create images! Please describe what you'd like me to generate, and I'll create it for you.", false);
            }, 1000);
        }

        function askLifeTips() {
            addMessage("Give me some life tips", true);
            setTimeout(() => {
                addMessage("Here are some valuable life tips: 1) Stay curious and keep learning, 2) Practice gratitude daily, 3) Take care of your physical and mental health, 4) Build meaningful relationships, 5) Embrace challenges as growth opportunities. What specific area would you like more advice on?", false);
            }, 1500);
        }

        // Attach file function
        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '*/*';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    addMessage(`ðŸ“Ž Attached file: ${file.name}`, true);
                    addConsoleMessage(`File attached: ${file.name} (${file.size} bytes)`);
                }
            };
            input.click();
        }

        // Initialize on page load
        window.addEventListener('load', initializeChat);
    </script>
</body>
</html>